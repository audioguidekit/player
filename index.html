<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#ffffff" />
  <meta name="description" content="Explore rich history with immersive guided audio tours" />
  <link rel="manifest" href="/manifest.webmanifest" />

  <!-- iOS Specific -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="AudioTour" />
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />

  <title>Audio Tour Pro</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Condensed:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  <style>
    /* Ensure full viewport height including safe areas */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    .no-scrollbar {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
    }
  </style>
  <script type="importmap">
{
  "imports": {
    "framer-motion": "https://aistudiocdn.com/framer-motion@^12.23.24",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0"
  }
}
</script>
</head>

<body>
  <div id="root">
    <!-- Loading indicator shown while app initializes -->
    <div
      style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: 'Inter', sans-serif; color: #666;">
      <div style="text-align: center;">
        <div
          style="width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px;">
        </div>
        <div>Loading...</div>
      </div>
    </div>
    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </div>
  <script>
    // Register service worker immediately for better offline support on iOS
    console.log('[APP] Starting SW registration...');
    console.log('[APP] Online status:', navigator.onLine ? 'ONLINE' : 'OFFLINE');

    if ('serviceWorker' in navigator && !/localhost/.test(window.location)) {
      navigator.serviceWorker.register('/sw.js', { scope: '/' })
        .then(registration => {
          console.log('[APP] ✅ SW registered successfully');
          console.log('[APP] SW state:', {
            installing: registration.installing ? 'yes' : 'no',
            waiting: registration.waiting ? 'yes' : 'no',
            active: registration.active ? 'yes' : 'no',
            scope: registration.scope,
            updateViaCache: registration.updateViaCache
          });

          if (registration.active) {
            console.log('[APP] Active SW state:', registration.active.state);
          }

          // Listen for SW state changes
          registration.addEventListener('updatefound', () => {
            console.log('[APP] SW update found!');
            const newWorker = registration.installing;
            if (newWorker) {
              newWorker.addEventListener('statechange', () => {
                console.log('[APP] SW state changed to:', newWorker.state);
              });
            }
          });
        })
        .catch(err => {
          console.error('[APP] ❌ SW registration failed:', err);
        });

      // Log when SW controller changes
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        console.log('[APP] SW controller changed - new SW is now active');
      });

      // Check current controller
      if (navigator.serviceWorker.controller) {
        console.log('[APP] Page is currently controlled by SW:', navigator.serviceWorker.controller.scriptURL);
      } else {
        console.log('[APP] ⚠️ Page is NOT controlled by any SW yet');
      }
    } else {
      console.log('[APP] SW not supported or running on localhost');
    }

    // Monitor online/offline status
    window.addEventListener('online', () => console.log('[APP] Network: ONLINE'));
    window.addEventListener('offline', () => console.log('[APP] Network: OFFLINE'));
  </script>
  <script type="module" src="/index.tsx"></script>
</body>

</html>